import streamlit as st
import gspread
from google.oauth2.service_account import Credentials
import datetime
from streamlit_option_menu import option_menu

# --- 0. –ü–∞—Ä–∞“õ –±–∞–ø—Ç–∞—É–ª–∞—Ä—ã (”®–∑–≥–µ—Ä—ñ—Å—Å—ñ–∑) ---
st.set_page_config(
    page_title="–ë“ö2503 –ñ—É—Ä–Ω–∞–ª—ã",
    page_icon="üìö",
    layout="wide"
)

# --- CSS –°–¢–ò–õ–¨–î–ï–†–Ü (”®–∑–≥–µ—Ä—ñ—Å—Å—ñ–∑) ---
def load_css():
    st.markdown("""
        <style>
            .main .block-container { max-width: 90%; padding-top: 2rem; }
            div[data-testid="stForm"] {
                border: 1px solid #262730;
                background-color: #1a1c24;
                border-radius: 10px;
                padding: 20px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            }
            div[data-testid="stAlert"] {
                border-radius: 8px;
                border: 1px solid rgba(255, 255, 255, 0.1);
            }
        </style>
    """, unsafe_allow_html=True)

load_css()

# --- 1. –°—Ç—É–¥–µ–Ω—Ç—Ç–µ—Ä —Ç—ñ–∑—ñ–º—ñ (–ñ–ê“¢–ê–†–¢–´–õ–î–´ - 20 –û“ö–£–®–´) ---
STUDENT_LIST = [
    "–°—Ç—É–¥–µ–Ω—Ç—Ç—ñ —Ç–∞“£–¥–∞“£—ã–∑...",
    "–ê–π–∫–∏–º–±–∞–π –î–∂–∞–ª–∏–ª –†—É—Å—Ç–µ–º“±–ª—ã",
    "–ê–ª–ø—ã—Å–±–∞–µ–≤ –°–∞—è—Ç –°–∞–º–∞—Ç–æ–≤–∏—á",
    "–ê—Ä–¥–∞–±–µ–∫ –ï—Ä–ª–∞–Ω",
    "–ê—Å“õ–∞—Ä—Ö–∞–Ω ”ò–ª–∏—Ö–∞–Ω ”ò–¥—ñ–ª“±–ª—ã",
    "”ò–¥—ñ–ª—Ö–∞–Ω –ê—Ö–º–µ—Ç–∂–∞–Ω –ê–Ω–≤–∞—Ä“±–ª—ã",
    "–ë–∞–π–∑—É–ª–ª–æ–≤–∞ –ê–π–¥–∞–Ω–∞ –ö–∞–±–∏–±—É–ª–ª–æ–≤–Ω–∞",
    "–ë–∞—Ö—Ä–∏–¥–µ–Ω –ñ–∞–Ω–∞—Ç –ë”©–ª—Ç—ñ—Ä—ñ–∫“±–ª—ã",
    "–ë–æ–ª–∞—Ç–æ–≤–∞ –ó–µ—Ä–µ –î–∞—É–ª–µ—Ç–æ–≤–Ω–∞",
    "–ñ—É–º–∞–≥—É–ª–æ–≤–∞ –î–∏–ª—å–Ω–∞–∑ –ë–∞—É—ã—Ä–∂–∞–Ω–æ–≤–Ω–∞",
    "–ö–∞–ª–º–∞—à–æ–≤–∞ –ê—è–Ω–∞—Ç –ö—ã–¥—ã—Ä–±–µ–∫–∫—ã–∑—ã",
    "“ö–∞–±–∏–¥–µ–Ω –ô—É—Å—É—Ñ –ê–Ω—É–∞—Ä“±–ª—ã",
    "“ö–∞—Å–µ–Ω –ê—Ä—É–∂–∞–Ω –ù“±—Ä–∂–∞–Ω“õ—ã–∑—ã",
    "“ö“±—Ä–º–∞–Ω–±–∞–π –†–∞–º–∞–∑–∞–Ω –ë–∞“õ—ã—Ç–∂–∞–Ω“±–ª—ã",
    "–ú“±—Ä–∞—Ç –ê–π–∞—Ä—É –†–∏–∑–∞–±–µ–∫“õ—ã–∑—ã",
    "–ù—É—Ä—Å–µ–∏—Ç–æ–≤–∞ –ê—è–∂–∞–Ω –ê—Å–µ—Ç–æ–≤–Ω–∞",
    "–û—Ä—ã–º–±–µ–∫–æ–≤ –ë–∞—Ç—ã—Ä–∂–∞–Ω –ú–µ–¥–µ—Ç–æ–≤–∏—á",
    "–†–∞—Ö–∞—Ç“õ—ã–∑—ã –ê—Å—ã–ª–∑–∞—Ç",
    "–°–∞—Ä—Å–µ–Ω–±–∞–π –ê—Ö–º–µ—Ç",
    "–¢—ñ–ª–µ—É–±–µ–∫ –ù“±—Ä–∏—Å–ª–∞–º –ë–∞—É—ã—Ä–∂–∞–Ω“±–ª—ã",
    "–®–∞—Ö–∞–±–∞–µ–≤–∞ –ê“ì–∏–ª–∞ “í–∞–±–∏—Ç“õ—ã–∑—ã"
]

# --- 2. –ü”ô–Ω–¥–µ—Ä –∫–µ—Å—Ç–µ—Å—ñ (–¢“Æ–ó–ï–¢–Ü–õ–î–Ü) ---
DAILY_SCHEDULE = {
    0: ["“ö–∞–∑–∞“õ —Ç—ñ–ª—ñ", "–§–∏–∑–∏–∫–∞", "–ê“ì—ã–ª—à—ã–Ω —Ç—ñ–ª—ñ", "–û—Ä—ã—Å —Ç—ñ–ª—ñ –∂”ô–Ω–µ ”ô–¥–µ–±–∏–µ—Ç—ñ (–æ–Ω–ª–∞–π–Ω)", "–•–∏–º–∏—è (–æ–Ω–ª–∞–π–Ω)"], # –î—Å
    1: ["–ë–∏–æ–ª–æ–≥–∏—è", "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞", "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"], # –°—Å
    2: ["–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "“ö–∞–∑–∞“õ ”ô–¥–µ–±–∏–µ—Ç—ñ", "“ö–∞–∑–∞“õ —Ç—ñ–ª—ñ (–æ–Ω–ª–∞–π–Ω)"], # –°—Ä
    3: ["–î–µ–Ω–µ —Ç”ô—Ä–±–∏–µ—Å—ñ", "–•–∏–º–∏—è", "“ö–∞–∑–∞“õ—Å—Ç–∞–Ω —Ç–∞—Ä–∏—Ö—ã"], # –ë—Å
    4: ["–û—Ä—ã—Å —Ç—ñ–ª—ñ –∂”ô–Ω–µ ”ô–¥–µ–±–∏–µ—Ç—ñ", "–ê–ª“ì–∞—à“õ—ã ”ô—Å–∫–µ—Ä–∏ –∂”ô–Ω–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–ª—ã“õ –¥–∞–π—ã–Ω–¥—ã“õ"], # –ñ–º (4. –æ—Ä–Ω—ã–Ω–∞ 4: –¥–µ–ø —Ç“Ø–∑–µ—Ç—ñ–ª–¥—ñ)
    5: [], # –°–Ω
    6: []  # –ñ–∫
}

# --- 3. Google Sheets –ë–∞–ø—Ç–∞—É–ª–∞—Ä—ã (–ñ–ê“¢–ê–†–¢–´–õ–î–´) ---
GOOGLE_SHEET_NAME = "–°—Ç—É–¥–µ–Ω—Ç—Ç–µ—Ä–¥—ñ“£ –±–∞“ì–∞–ª–∞—Ä—ã"
LOG_WORKSHEET_NAME = "–õ–∏—Å—Ç1"       # 1-–ø–∞—Ä–∞“õ: –ë–∞—Ä–ª—ã“õ —Ç–∞—Ä–∏—Ö —Å–∞“õ—Ç–∞–ª–∞—Ç—ã–Ω –∂—É—Ä–Ω–∞–ª
VEDOMOST_WORKSHEET_NAME = "–í–µ–¥–æ–º–æ—Å—Ç—å" # 2-–ø–∞—Ä–∞“õ: "–ñ–∞–ª–ø–∞“õ" –∫–µ—Å—Ç–µ

# --- 4. Google Sheets –§—É–Ω–∫—Ü–∏—è–ª–∞—Ä—ã (–ï–ö–Ü –ü–ê–†–ê“ö–ü–ï–ù –ñ“∞–ú–´–°) ---

@st.cache_resource
def connect_to_gsheet():
    """Google Sheets-–∫–µ –±—ñ—Ä —Ä–µ—Ç “õ–æ—Å—ã–ª—É (”®–∑–≥–µ—Ä—ñ—Å—Å—ñ–∑)"""
    try:
        creds_dict = st.secrets["gcp_service_account"]
        creds = Credentials.from_service_account_info(creds_dict)
        scoped_creds = creds.with_scopes([
            "https://www.googleapis.com/auth/spreadsheets",
            "https://www.googleapis.com/auth/drive"
        ])
        client = gspread.authorize(scoped_creds)
        return client
    except Exception as e:
        st.error(f"Google Sheets-–∫–µ “õ–æ—Å—ã–ª—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ: {e}")
        return None

def append_to_log_sheet(client, sheet_name, log_ws_name, data_row):
    """1-”ò–†–ï–ö–ï–¢: –î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ '–õ–∏—Å—Ç1' –∂—É—Ä–Ω–∞–ª—ã–Ω–∞ “õ–∞—Ç–∞—Ä –µ—Ç—ñ–ø “õ–æ—Å—É."""
    try:
        sheet = client.open(sheet_name).worksheet(log_ws_name)
        sheet.append_row(data_row, value_input_option='USER_ENTERED')
        return True
    except gspread.exceptions.WorksheetNotFound:
        st.error(f"'{log_ws_name}' –∞—Ç—Ç—ã –ñ–£–†–ù–ê–õ –ø–∞—Ä–∞“ì—ã (—Ç–∞–±) —Ç–∞–±—ã–ª–º–∞–¥—ã. Google Sheet-—Ç–µ '–õ–∏—Å—Ç1' –∞—Ç—ã–º–µ–Ω —Ç–∞–± –±–∞—Ä—ã–Ω —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑.")
        return False
    except Exception as e:
        st.error(f"–ñ—É—Ä–Ω–∞–ª“ì–∞ ('{log_ws_name}') —Å–∞“õ—Ç–∞—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ: {e}")
        return False

def update_vedomost_cell(client, sheet_name, vedomost_ws_name, student_name, subject_name, grade):
    """2-”ò–†–ï–ö–ï–¢: –ë–∞“ì–∞–Ω—ã '–í–µ–¥–æ–º–æ—Å—Ç—å' –ø–∞—Ä–∞“ì—ã–Ω–¥–∞“ì—ã –¥“±—Ä—ã—Å “±—è—à—ã“õ“õ–∞ –∂–∞“£–∞—Ä—Ç—É."""
    try:
        sheet = client.open(sheet_name).worksheet(vedomost_ws_name)
        
        # 1. “ö–∞—Ç–∞—Ä–¥—ã (–°—Ç—É–¥–µ–Ω—Ç—Ç—ñ) —Ç–∞–±—É
        # (–ï—Å–∫–µ—Ä—Ç—É: –°—Ç—É–¥–µ–Ω—Ç—Ç–µ—Ä–¥—ñ“£ –∞—Ç—Ç–∞—Ä—ã 1-–±–∞“ì–∞–Ω–¥–∞ (A) –±–æ–ª—É—ã –∫–µ—Ä–µ–∫)
        cell_list = sheet.findall(student_name, in_column=1)
        if not cell_list:
            st.warning(f"'{student_name}' '–í–µ–¥–æ–º–æ—Å—Ç—å' –ø–∞—Ä–∞“ì—ã–Ω—ã“£ 1-–±–∞“ì–∞–Ω—ã–Ω–∞–Ω —Ç–∞–±—ã–ª–º–∞–¥—ã. (1-“ö–ê–î–ê–ú-–¥—ã —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑)")
            return False
        row_index = cell_list[0].row
        
        # 2. –ë–∞“ì–∞–Ω–¥—ã (–ü”ô–Ω–¥—ñ) —Ç–∞–±—É
        # (–ï—Å–∫–µ—Ä—Ç—É: –ü”ô–Ω–¥–µ—Ä–¥—ñ“£ –∞—Ç—Ç–∞—Ä—ã 1-“õ–∞—Ç–∞—Ä–¥–∞ (1) –±–æ–ª—É—ã –∫–µ—Ä–µ–∫)
        
        # –ü”ô–Ω–Ω—ñ“£ " (–æ–Ω–ª–∞–π–Ω)" –Ω–µ–º–µ—Å–µ " (–∞—É—ã—Å–ø–∞–ª—ã)" —Å–∏—è“õ—Ç—ã “õ–æ—Å—ã–º—à–∞–ª–∞—Ä—ã–Ω –∞–ª—ã–ø —Ç–∞—Å—Ç–∞—É“ì–∞ —Ç—ã—Ä—ã—Å—É
        # –ú—ã—Å–∞–ª—ã: "“ö–∞–∑–∞“õ —Ç—ñ–ª—ñ (–æ–Ω–ª–∞–π–Ω)" -> "“ö–∞–∑–∞“õ —Ç—ñ–ª—ñ"
        # –ë—ñ—Ä–∞“õ "–û—Ä—ã—Å —Ç—ñ–ª—ñ –∂”ô–Ω–µ ”ô–¥–µ–±–∏–µ—Ç—ñ" —Å–∏—è“õ—Ç—ã “±–∑—ã–Ω –∞—Ç—Ç–∞—Ä–¥—ã —Å–∞“õ—Ç–∞—É
        
        # –ê–ª–¥—ã–º–µ–Ω —Ç–æ–ª—ã“õ –∞—Ç–ø–µ–Ω —ñ–∑–¥–µ—É
        cell_list = sheet.findall(subject_name, in_row=1)
        
        if not cell_list:
             # –ï–≥–µ—Ä —Ç–∞–±—ã–ª–º–∞—Å–∞, " (" —Ç–∞“£–±–∞—Å—ã–Ω–∞ –¥–µ–π—ñ–Ω “õ—ã—Å“õ–∞—Ä—Ç—ã–ø —ñ–∑–¥–µ—É
             if " (" in subject_name:
                subject_name_base = subject_name.split(" (")[0]
             else:
                subject_name_base = subject_name
                
             cell_list = sheet.findall(subject_name_base, in_row=1)
        
        if not cell_list:
            st.warning(f"'{subject_name}' (–Ω–µ–º–µ—Å–µ –æ–Ω—ã“£ –Ω–µ–≥—ñ–∑–≥—ñ –∞—Ç–∞—É—ã) '–í–µ–¥–æ–º–æ—Å—Ç—å' –ø–∞—Ä–∞“ì—ã–Ω—ã“£ 1-“õ–∞—Ç–∞—Ä—ã–Ω–∞–Ω —Ç–∞–±—ã–ª–º–∞–¥—ã. (1-“ö–ê–î–ê–ú-–¥—ã —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑)")
            return False
        
        col_index = cell_list[0].col
        
        # 3. “∞—è—à—ã“õ—Ç—ã (Cell) –∂–∞“£–∞—Ä—Ç—É
        sheet.update_cell(row_index, col_index, grade)
        return True
        
    except gspread.exceptions.WorksheetNotFound:
        st.error(f"'{vedomost_ws_name}' –∞—Ç—Ç—ã –í–ï–î–û–ú–û–°–¢–¨ –ø–∞—Ä–∞“ì—ã (—Ç–∞–±) —Ç–∞–±—ã–ª–º–∞–¥—ã.")
        st.warning("Google Sheet —Ñ–∞–π–ª—ã“£—ã–∑–¥–∞ '–í–µ–¥–æ–º–æ—Å—Ç—å' –∞—Ç—Ç—ã –µ–∫—ñ–Ω—à—ñ —Ç–∞–± –∞—à—ã–ø, 1-“ö–ê–î–ê–ú-–¥–∞“ì—ã–¥–∞–π –¥–∞–π—ã–Ω–¥–∞“£—ã–∑.")
        return False
    except Exception as e:
        st.error(f"'–í–µ–¥–æ–º–æ—Å—Ç—å' –ø–∞—Ä–∞“ì—ã–Ω –∂–∞“£–∞—Ä—Ç—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ: {e}")
        return False

# --- 5. Streamlit –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ (”®–∑–≥–µ—Ä—ñ—Å—Å—ñ–∑) ---

st.title("üìö –ö“Ø–Ω–¥–µ–ª—ñ–∫—Ç—ñ –±–∞“ì–∞ –∂—É—Ä–Ω–∞–ª—ã (–ë“ö2503)")

selected_tab = option_menu(
    menu_title=None, 
    options=["–ë–∞“ì–∞ –µ–Ω–≥—ñ–∑—É", "–°–∞–±–∞“õ –∫–µ—Å—Ç–µ—Å—ñ", "–•–∞–±–∞—Ä–ª–∞–Ω–¥—ã—Ä—É–ª–∞—Ä"], 
    icons=['pencil-square', 'calendar-week', 'bell-fill'], 
    menu_icon="cast", 
    default_index=0, 
    orientation="horizontal",
    styles={
        "container": {"padding": "0!important", "background-color": "#0E117"},
        "icon": {"color": "#FF4B4B", "font-size": "18px"}, 
        "nav-link": {"font-size": "16px", "text-align": "center", "margin":"0px", "--hover-color": "#262730"},
        "nav-link-selected": {"background-color": "#FF4B4B", "color": "white", "font-weight": "bold"},
    }
)

# --- –ë”®–õ–Ü–ú 1: –ë–ê“í–ê –ï–ù–ì–Ü–ó–£ (–õ–æ–≥–∏–∫–∞—Å—ã –ñ–ê“¢–ê–†–¢–´–õ–î–´) ---
if selected_tab == "–ë–∞“ì–∞ –µ–Ω–≥—ñ–∑—É":
    st.info("–ö“Ø–Ω–¥—ñ —Ç–∞“£–¥–∞—Å–∞“£—ã–∑, —Å–æ–ª –∫“Ø–Ω–Ω—ñ“£ –ø”ô–Ω–¥–µ—Ä—ñ —Ç—ñ–∑—ñ–º–¥–µ –∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ —à—ã“ì–∞–¥—ã.")
    
    # --- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±”©–ª—ñ–º—ñ (”®–∑–≥–µ—Ä—ñ—Å—Å—ñ–∑) ---
    st.subheader("1. –°–∞–±–∞“õ –∞“õ–ø–∞—Ä–∞—Ç—ã")
    col1, col2 = st.columns(2)
    
    with col1:
        selected_day = st.date_input("üìÖ –°–∞–±–∞“õ –∫“Ø–Ω—ñ–Ω —Ç–∞“£–¥–∞“£—ã–∑", datetime.date.today(), format="DD.MM.YYYY")
    
    with col2:
        day_of_week = selected_day.weekday() 
        week_number = selected_day.isocalendar()[1] 
        is_even_week = (week_number % 2 == 0)
        todays_subjects = list(DAILY_SCHEDULE.get(day_of_week, []))

        if day_of_week == 2:
            if is_even_week: todays_subjects.insert(1, "–§–∏–∑–∏–∫–∞ (–∞—É—ã—Å–ø–∞–ª—ã)") 
            else: todays_subjects.insert(1, "–ê“ì—ã–ª—à—ã–Ω —Ç—ñ–ª—ñ (–∞—É—ã—Å–ø–∞–ª—ã)")
        elif day_of_week == 4:
            if is_even_week: todays_subjects.append("–ì–µ–æ–≥—Ä–∞—Ñ–∏—è (–∞—É—ã—Å–ø–∞–ª—ã)")
            else: todays_subjects.append("–î“Ø–Ω–∏–µ–∂“Ø–∑—ñ —Ç–∞—Ä–∏—Ö—ã (–∞—É—ã—Å–ø–∞–ª—ã)")
        
        if not todays_subjects: 
            subject_options = ["–ë“Ø–≥—ñ–Ω —Å–∞–±–∞“õ –∂–æ“õ", "–ë–∞—Å“õ–∞ –ø”ô–Ω (—Ç”©–º–µ–Ω–≥–µ –∂–∞–∑—ã“£—ã–∑)"]
        else:
            subject_options = ["–ü”ô–Ω–¥—ñ —Ç–∞“£–¥–∞“£—ã–∑..."] + todays_subjects + ["–ë–∞—Å“õ–∞ –ø”ô–Ω (—Ç”©–º–µ–Ω–≥–µ –∂–∞–∑—ã“£—ã–∑)"]
        
        selected_subject = st.selectbox("üìì –ü”ô–Ω–¥—ñ —Ç–∞“£–¥–∞“£—ã–∑", options=subject_options, index=0)

    other_subject = ""
    if selected_subject == "–ë–∞—Å“õ–∞ –ø”ô–Ω (—Ç”©–º–µ–Ω–≥–µ –∂–∞–∑—ã“£—ã–∑)":
        other_subject = st.text_input("–ü”ô–Ω–Ω—ñ“£ –∞—Ç—ã–Ω –∂–∞–∑—ã“£—ã–∑:", placeholder="–ú—ã—Å: –≠–ª–µ–∫—Ç–∏–≤")

    st.divider()

    # --- –§–æ—Ä–º–∞ (”®–∑–≥–µ—Ä—ñ—Å—Å—ñ–∑) ---
    with st.form("grade_form"):
        st.subheader("2. –ë–∞“ì–∞–ª–∞—É –º”ô–ª—ñ–º–µ—Ç—Ç–µ—Ä—ñ")
        selected_student = st.selectbox("üßë‚Äçüéì –°—Ç—É–¥–µ–Ω—Ç—Ç—ñ“£ –∞—Ç—ã-–∂”©–Ω—ñ", options=STUDENT_LIST, index=0)
        grade = st.number_input("üíØ –ë–∞“ì–∞ (0-100)", min_value=0.0, max_value=100.0, value=75.0, step=1.0)
        comment = st.text_area("‚úçÔ∏è –¢“Ø—Å—ñ–Ω—ñ–∫—Ç–µ–º–µ (–º—ñ–Ω–¥–µ—Ç—Ç—ñ –µ–º–µ—Å)", placeholder="–ú—ã—Å–∞–ª—ã: “Æ–π –∂“±–º—ã—Å—ã ‚Ññ3, C”®–ñ-1...")
        st.divider()
        submitted = st.form_submit_button("üíæ –ë–∞“ì–∞–Ω—ã —Å–∞“õ—Ç–∞—É", type="primary", use_container_width=True)

    # --- –°–∞“õ—Ç–∞—É –ª–æ–≥–∏–∫–∞—Å—ã (–ñ–ê“¢–ê–†–¢–´–õ–î–´) ---
    if submitted:
        final_subject = other_subject if selected_subject == "–ë–∞—Å“õ–∞ –ø”ô–Ω (—Ç”©–º–µ–Ω–≥–µ –∂–∞–∑—ã“£—ã–∑)" else selected_subject
        
        # –¢–µ–∫—Å–µ—Ä—ñ—Å—Ç–µ—Ä (”®–∑–≥–µ—Ä—ñ—Å—Å—ñ–∑)
        if final_subject == "–ü”ô–Ω–¥—ñ —Ç–∞“£–¥–∞“£—ã–∑..." or final_subject == "–ë“Ø–≥—ñ–Ω —Å–∞–±–∞“õ –∂–æ“õ" or not final_subject:
            st.warning("‚ö†Ô∏è '–ü”ô–Ω–¥—ñ' —Ç–∞“£–¥–∞“£—ã–∑ –Ω–µ–º–µ—Å–µ –∂–∞–∑—ã“£—ã–∑.", icon="‚úã")
        elif selected_student == "–°—Ç—É–¥–µ–Ω—Ç—Ç—ñ —Ç–∞“£–¥–∞“£—ã–∑...":
            st.warning("‚ö†Ô∏è '–°—Ç—É–¥–µ–Ω—Ç—Ç—ñ' —Ç–∞“£–¥–∞“£—ã–∑.", icon="üßë‚Äçüéì")
        else:
            with st.spinner(f"'{selected_student}' “Ø—à—ñ–Ω –±–∞“ì–∞ —Å–∞“õ—Ç–∞–ª—É–¥–∞..."):
                client = connect_to_gsheet()
                if client:
                    current_time = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
                    
                    # 1. '–õ–∏—Å—Ç1' –∂—É—Ä–Ω–∞–ª—ã–Ω–∞ –∞—Ä–Ω–∞–ª“ì–∞–Ω —Ç–æ–ª—ã“õ –¥–µ—Ä–µ–∫—Ç–µ—Ä
                    data_to_log = [
                        selected_day.strftime("%Y-%m-%d"),
                        final_subject,
                        selected_student,
                        grade,
                        comment,
                        current_time
                    ]
                    
                    # 1-”ò–†–ï–ö–ï–¢: –ñ—É—Ä–Ω–∞–ª“ì–∞ —Å–∞“õ—Ç–∞—É
                    success_log = append_to_log_sheet(client, GOOGLE_SHEET_NAME, LOG_WORKSHEET_NAME, data_to_log)
                    
                    # 2-”ò–†–ï–ö–ï–¢: –í–µ–¥–æ–º–æ—Å—Ç—å—Ç—ã –∂–∞“£–∞—Ä—Ç—É
                    success_vedomost = update_vedomost_cell(client, GOOGLE_SHEET_NAME, VEDOMOST_WORKSHEET_NAME, selected_student, final_subject, grade)
                    
                    # –ù”ô—Ç–∏–∂–µ–Ω—ñ —Ç–µ–∫—Å–µ—Ä—É
                    if success_log and success_vedomost:
                        st.success(f"‚úÖ –ë–∞“ì–∞ ({grade}) —Å”ô—Ç—Ç—ñ —Å–∞“õ—Ç–∞–ª–¥—ã!")
                        st.info(f"'{VEDOMOST_WORKSHEET_NAME}' –ø–∞—Ä–∞“ì—ã –¥–∞ –∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ –∂–∞“£–∞—Ä—Ç—ã–ª–¥—ã.")
                        st.balloons()
                    elif success_log and not success_vedomost:
                        # –ñ—É—Ä–Ω–∞–ª“ì–∞ —Å–∞“õ—Ç–∞–ª–¥—ã, –±—ñ—Ä–∞“õ –≤–µ–¥–æ–º–æ—Å—Ç—å“õ–∞ —Å–∞“õ—Ç–∞–ª–º–∞–¥—ã
                        st.warning(f"‚úÖ –ë–∞“ì–∞ –∂—É—Ä–Ω–∞–ª“ì–∞ ('{LOG_WORKSHEET_NAME}') —Å–∞“õ—Ç–∞–ª–¥—ã, –±—ñ—Ä–∞“õ '{VEDOMOST_WORKSHEET_NAME}' –∂–∞“£–∞—Ä—Ç—ã–ª–º–∞–¥—ã.")
                        st.warning("–í–µ–¥–æ–º–æ—Å—Ç—å –ø–∞—Ä–∞“ì—ã–Ω 1-“ö–ê–î–ê–ú-–¥–∞“ì—ã –Ω“±—Å“õ–∞—É–ª—ã“õ –±–æ–π—ã–Ω—à–∞ —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑ (–∞—Ç—ã, –ø”ô–Ω–¥–µ—Ä, —Å—Ç—É–¥–µ–Ω—Ç—Ç–µ—Ä —Ç—ñ–∑—ñ–º—ñ).")
                    else:
                        st.error("‚ùå –î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ Google Sheet-–∫–µ —Å–∞“õ—Ç–∞—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã.")

# --- –ë”®–õ–Ü–ú 2: –°–ê–ë–ê“ö –ö–ï–°–¢–ï–°–Ü (”®–∑–≥–µ—Ä—ñ—Å—Å—ñ–∑) ---
if selected_tab == "–°–∞–±–∞“õ –∫–µ—Å—Ç–µ—Å—ñ":
    st.subheader("–ë“ö2503 —Ç–æ–±—ã–Ω—ã“£ —Å–∞–±–∞“õ –∫–µ—Å—Ç–µ—Å—ñ")
    st.info("–ë“±–ª —Å—ñ–∑–¥—ñ“£ —Ä–µ—Å–º–∏ —Å–∞–±–∞“õ –∫–µ—Å—Ç–µ“£—ñ–∑. '–ë–∞“ì–∞ –µ–Ω–≥—ñ–∑—É' –±–µ—Ç—ñ–Ω–¥–µ–≥—ñ –ø”ô–Ω–¥–µ—Ä —Ç—ñ–∑—ñ–º—ñ –æ—Å—ã –∫–µ—Å—Ç–µ–≥–µ –Ω–µ–≥—ñ–∑–¥–µ–ª–≥–µ–Ω.")
    try:
        st.image("2025-11-24 23.56.03.jpg", caption="–†–µ—Å–º–∏ —Å–∞–±–∞“õ –∫–µ—Å—Ç–µ—Å—ñ (–°—É—Ä–µ—Ç—Ç—ñ “Ø–ª–∫–µ–π—Ç—É “Ø—à—ñ–Ω –±–∞—Å—ã“£—ã–∑)")
    except Exception as e:
        st.error(f"‚ö†Ô∏è C–∞–±–∞“õ –∫–µ—Å—Ç–µ—Å—ñ–Ω—ñ“£ —Å—É—Ä–µ—Ç—ñ–Ω –∂“Ø–∫—Ç–µ—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ –∫–µ—Ç—Ç—ñ.")
        st.warning("–°—É—Ä–µ—Ç—Ç—ñ ('2025-11-24 23.56.03.jpg') GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π—ñ“£—ñ–∑–≥–µ –∂“Ø–∫—Ç–µ–≥–µ–Ω—ñ“£—ñ–∑–¥—ñ —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑.")

# --- –ë”®–õ–Ü–ú 3: –•–ê–ë–ê–†–õ–ê–ù–î–´–†–£–õ–ê–† (”®–∑–≥–µ—Ä—ñ—Å—Å—ñ–∑) ---
if selected_tab == "–•–∞–±–∞—Ä–ª–∞–Ω–¥—ã—Ä—É–ª–∞—Ä":
    st.subheader("üì¢ –°–æ“£“ì—ã –∂–∞“£–∞–ª—ã“õ—Ç–∞—Ä –º–µ–Ω —Ö–∞–±–∞—Ä–ª–∞–Ω–¥—ã—Ä—É–ª–∞—Ä")
    st.write("–ú“±–Ω–¥–∞ —Ç–æ–ø“õ–∞ “õ–∞—Ç—ã—Å—Ç—ã –º–∞“£—ã–∑–¥—ã –∞“õ–ø–∞—Ä–∞—Ç –∂–∞—Ä–∏—è–ª–∞–Ω—ã–ø —Ç“±—Ä–∞–¥—ã.")
    st.divider()
    st.warning(
        "üî• **–ú–∞“£—ã–∑–¥—ã (–î–µ–¥–ª–∞–π–Ω):** '–ë–∞—Å“õ–∞ “õ–∞–ª–∞–¥–∞–Ω –∫–µ–ª–≥–µ–Ω–¥–µ—Ä '27-–Ω–µ–Ω 7-–Ω–µ –¥–µ–π—ñ–Ω' “Ø–π–ª–µ—Ä—ñ–Ω–µ –±–∞—Ä—ã–ø –∫–µ–ª—É–≥–µ –±–æ–ª–∞–¥—ã, ”©—Ç—ñ–Ω—ñ—à –∂–∞–∑—É –∞—Ä“õ—ã–ª—ã, ”®—Ç—ñ–Ω—ñ—à—Ç—ñ –∞—Ç–∞-–∞–Ω–∞ –∂–∞–∑—É –∫–µ—Ä–µ–∫.", 
        icon="üî•"
    )
    st.markdown("""
    ---
    #### –ú“±—Ä–∞“ì–∞—Ç (–ï—Å–∫—ñ –∂–∞“£–∞–ª—ã“õ—Ç–∞—Ä)
    * *17.11.2025 - 24.11.2025  –ê—Ä–∞–ª—ã“õ (—Ä—É–±–µ–∂–∫–∞) —É–∞“õ—ã—Ç—ã.*
    * *‚ÑπÔ∏è –ñ–∞–ª–ø—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞: '–ù“±—Ä–∏—Å–ª–∞–º' –º–µ–Ω '–ê“ì–∏–ª–∞' –§–∏–∑–∏–∫–∞–¥–∞–Ω —Ç–∞“õ—Ç–∞“ì–∞ —à—ã“ì–∞–¥—ã 26.11.2025 –∂.*
        
    * *–ñ“Ø—Ä–≥—ñ–∑—É—à—ñ–ª–µ—Ä–¥—ñ '–ë–∏–æ–ª–æ–≥–∏—è' —Å–∞–±–∞“ì—ã–Ω—ã“£ 2 —à—ñ 45 –º–∏–Ω—É—Ç—Ç–∞–Ω (–ø–æ–ª—É–ø–∞—Ä–∞) —Å“±—Ä–∞–ø –∞–ª–¥—ã* ‚ùå
    """)
